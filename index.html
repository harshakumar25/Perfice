<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeFlow Pro - Professional Coding Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            min-height: 100vh;
        }

        .glass-effect {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .gradient-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .gradient-success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
        }

        .gradient-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%);
        }

        .gradient-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
        }

        .gradient-info {
            background: linear-gradient(135deg, var(--info) 0%, #60a5fa 100%);
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .platform-card {
            position: relative;
            overflow: hidden;
        }

        .platform-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .leetcode-card::before { background: #FFA116; }
        .github-card::before { background: #24292e; }
        .tryhackme-card::before { background: #212331; }
        .codeforces-card::before { background: #3b5998; }

        .streak-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .streak-dot.active {
            background: linear-gradient(135deg, #10b981, #34d399);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .streak-dot.inactive {
            background: #334155;
        }

        .streak-dot.today {
            border: 2px solid #10b981;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.5s ease;
        }

        .typewriter {
            overflow: hidden;
            border-right: 3px solid var(--primary);
            white-space: nowrap;
            animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--primary); }
        }

        .tab-active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .hobby-locked {
            position: relative;
        }

        .hobby-locked::after {
            content: "ðŸ”’";
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            opacity: 0.5;
        }

        .level-up {
            animation: levelUp 0.5s ease-out;
        }

        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #475569 #1e293b;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }

        .input-focus {
            transition: all 0.3s ease;
        }

        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
        }

        .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::after {
            opacity: 1;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Welcome Modal -->
    <div id="welcomeModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 max-w-2xl w-full text-center border border-white/10">
            <div class="floating mb-8">
                <div class="w-24 h-24 gradient-primary rounded-full flex items-center justify-center mx-auto">
                    <i class="fas fa-graduation-cap text-3xl text-white"></i>
                </div>
            </div>
            
            <h1 class="text-4xl font-bold mb-4 gradient-text">Welcome to CodeFlow Pro! ðŸš€</h1>
            <p class="text-xl mb-8 text-gray-300">Your ultimate coding progress tracker</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="glass-effect p-4 rounded-xl border border-white/5">
                    <div class="w-12 h-12 gradient-primary rounded-lg flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-trophy text-xl text-white"></i>
                    </div>
                    <h3 class="font-bold mb-1">Gamified Learning</h3>
                    <p class="text-sm text-gray-400">Earn points, unlock achievements, level up</p>
                </div>
                <div class="glass-effect p-4 rounded-xl border border-white/5">
                    <div class="w-12 h-12 gradient-success rounded-lg flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-fire text-xl text-white"></i>
                    </div>
                    <h3 class="font-bold mb-1">Streak Tracking</h3>
                    <p class="text-sm text-gray-400">Track your consistency across all platforms</p>
                </div>
                <div class="glass-effect p-4 rounded-xl border border-white/5">
                    <div class="w-12 h-12 gradient-info rounded-lg flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-chart-line text-xl text-white"></i>
                    </div>
                    <h3 class="font-bold mb-1">Real-time Stats</h3>
                    <p class="text-sm text-gray-400">Monitor progress from multiple platforms</p>
                </div>
            </div>
            
            <button onclick="closeWelcomeModal()" class="gradient-primary text-white px-8 py-3 rounded-full text-lg font-semibold hover:opacity-90 transition-all duration-300 transform hover:scale-105">
                Get Started <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <!-- Platform Integration Modal -->
    <div id="platformModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-white/10">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-2xl font-bold mb-2">Connect Your Coding Platforms</h2>
                    <p class="text-gray-400">Add your usernames to track real progress</p>
                </div>
                <button onclick="closePlatformModal()" class="text-gray-400 hover:text-white text-2xl transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- GitHub Card -->
                <div class="glass-effect rounded-xl p-6 border border-white/5">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center">
                            <i class="fab fa-github text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">GitHub</h3>
                            <p class="text-sm text-gray-400">Track your repositories and commits</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">GitHub Username</label>
                            <div class="relative">
                                <i class="fab fa-github absolute left-3 top-3 text-gray-400"></i>
                                <input type="text" id="githubUsername" 
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white input-focus"
                                       placeholder="e.g., octocat">
                            </div>
                        </div>
                        <button onclick="connectGitHub()" class="w-full bg-gray-800 hover:bg-gray-700 text-white py-3 rounded-lg font-medium transition">
                            <i class="fas fa-plug mr-2"></i> Connect GitHub
                        </button>
                    </div>
                </div>

                <!-- LeetCode Card -->
                <div class="glass-effect rounded-xl p-6 border border-white/5">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 gradient-warning rounded-lg flex items-center justify-center">
                            <i class="fab fa-leetcode text-2xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">LeetCode</h3>
                            <p class="text-sm text-gray-400">Track problems solved and streak</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">LeetCode Username</label>
                            <div class="relative">
                                <i class="fab fa-leetcode absolute left-3 top-3 text-gray-400"></i>
                                <input type="text" id="leetcodeUsername" 
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white input-focus"
                                       placeholder="e.g., leet_user">
                            </div>
                        </div>
                        <button onclick="connectLeetCode()" class="w-full gradient-warning text-white py-3 rounded-lg font-medium hover:opacity-90 transition">
                            <i class="fas fa-plug mr-2"></i> Connect LeetCode
                        </button>
                    </div>
                </div>

                <!-- TryHackMe Card -->
                <div class="glass-effect rounded-xl p-6 border border-white/5">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 gradient-danger rounded-lg flex items-center justify-center">
                            <i class="fas fa-shield-alt text-2xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">TryHackMe</h3>
                            <p class="text-sm text-gray-400">Track rooms completed and ranking</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">TryHackMe Username</label>
                            <div class="relative">
                                <i class="fas fa-shield-alt absolute left-3 top-3 text-gray-400"></i>
                                <input type="text" id="tryhackmeUsername" 
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white input-focus"
                                       placeholder="e.g., tryhackme_user">
                            </div>
                        </div>
                        <button onclick="connectTryHackMe()" class="w-full gradient-danger text-white py-3 rounded-lg font-medium hover:opacity-90 transition">
                            <i class="fas fa-plug mr-2"></i> Connect TryHackMe
                        </button>
                    </div>
                </div>

                <!-- Codeforces Card -->
                <div class="glass-effect rounded-xl p-6 border border-white/5">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 gradient-info rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-2xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Codeforces</h3>
                            <p class="text-sm text-gray-400">Track rating and contests</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Codeforces Handle</label>
                            <div class="relative">
                                <i class="fas fa-chart-line absolute left-3 top-3 text-gray-400"></i>
                                <input type="text" id="codeforcesUsername" 
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white input-focus"
                                       placeholder="e.g., tourist">
                            </div>
                        </div>
                        <button onclick="connectCodeforces()" class="w-full gradient-info text-white py-3 rounded-lg font-medium hover:opacity-90 transition">
                            <i class="fas fa-plug mr-2"></i> Connect Codeforces
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex gap-3 justify-end">
                <button onclick="closePlatformModal()" class="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition">
                    Cancel
                </button>
                <button onclick="savePlatformConnections()" class="px-6 py-3 gradient-success text-white rounded-lg hover:opacity-90 transition">
                    <i class="fas fa-save mr-2"></i> Save All Connections
                </button>
            </div>
        </div>
    </div>

    <!-- Authentication Screen -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <!-- Logo & Title -->
            <div class="text-center mb-8">
                <div class="w-24 h-24 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl floating">
                    <i class="fas fa-graduation-cap text-3xl text-white"></i>
                </div>
                <h1 class="text-4xl font-bold mb-2">CodeFlow Pro</h1>
                <p class="text-gray-400">Level up your coding journey</p>
            </div>

            <!-- Auth Tabs -->
            <div class="glass-effect rounded-2xl p-1 mb-6 border border-white/5">
                <div class="flex">
                    <button id="loginTabBtn" class="flex-1 py-3 rounded-xl font-semibold tab-active" onclick="switchAuthTab('login')">
                        Sign In
                    </button>
                    <button id="registerTabBtn" class="flex-1 py-3 rounded-xl font-semibold text-gray-400" onclick="switchAuthTab('register')">
                        Register
                    </button>
                </div>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="glass-effect rounded-2xl p-8 border border-white/5">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Email Address</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                            <input type="email" id="loginEmail" 
                                   class="w-full bg-gray-800 border border-gray-700 rounded-xl pl-10 pr-4 py-3 text-white input-focus"
                                   placeholder="your.email@example.com">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                            <input type="password" id="loginPassword" 
                                   class="w-full bg-gray-800 border border-gray-700 rounded-xl pl-10 pr-4 py-3 text-white input-focus"
                                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="rememberMe" class="rounded bg-gray-700 border-gray-600">
                            <span class="ml-2 text-sm">Remember me</span>
                        </label>
                        <button class="text-sm text-blue-400 hover:text-blue-300 transition">Forgot password?</button>
                    </div>

                    <button onclick="login()" class="w-full gradient-primary text-white py-3 rounded-xl font-semibold hover:opacity-90 transition">
                        <i class="fas fa-sign-in-alt mr-2"></i> Sign In
                    </button>

                    <div class="text-center pt-4 border-t border-gray-800">
                        <p class="text-sm text-gray-400">Don't have an account? 
                            <button onclick="switchAuthTab('register')" class="text-blue-400 hover:text-blue-300 transition">Sign up</button>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="glass-effect rounded-2xl p-8 border border-white/5 hidden">
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">First Name</label>
                            <input type="text" id="registerFirstName" 
                                   class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                                   placeholder="John">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Last Name</label>
                            <input type="text" id="registerLastName" 
                                   class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                                   placeholder="Doe">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Email Address</label>
                        <input type="email" id="registerEmail" 
                               class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                               placeholder="your.email@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Password</label>
                        <input type="password" id="registerPassword" 
                               class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                               placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        <div class="text-xs text-gray-400 mt-1">Minimum 8 characters with letters and numbers</div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Confirm Password</label>
                        <input type="password" id="registerConfirmPassword" 
                               class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                               placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>

                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="acceptTerms" class="rounded bg-gray-700 border-gray-600">
                        <span class="ml-2 text-sm">
                            I agree to the <a href="#" class="text-blue-400 hover:text-blue-300">Terms</a> and <a href="#" class="text-blue-400 hover:text-blue-300">Privacy Policy</a>
                        </span>
                    </label>

                    <button onclick="register()" class="w-full gradient-success text-white py-3 rounded-xl font-semibold hover:opacity-90 transition">
                        <i class="fas fa-user-plus mr-2"></i> Create Account
                    </button>

                    <div class="text-center pt-4 border-t border-gray-800">
                        <p class="text-sm text-gray-400">Already have an account? 
                            <button onclick="switchAuthTab('login')" class="text-blue-400 hover:text-blue-300 transition">Sign in</button>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen">
        <!-- Navigation -->
        <nav class="glass-effect sticky top-0 z-40 border-b border-white/10">
            <div class="max-w-7xl mx-auto px-4 py-3">
                <div class="flex justify-between items-center">
                    <!-- Logo & Brand -->
                    <div class="flex items-center gap-3">
                        <div class="gradient-primary p-2 rounded-lg">
                            <i class="fas fa-graduation-cap text-xl text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold">CodeFlow Pro</h1>
                            <div class="text-xs text-gray-400" id="userGreeting">Welcome back!</div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="flex items-center gap-6">
                        <!-- Points Display -->
                        <div class="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-lg">
                            <div class="w-8 h-8 bg-gradient-to-r from-yellow-500 to-amber-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-coins text-white"></i>
                            </div>
                            <div>
                                <div class="text-xs opacity-80">Points</div>
                                <div class="font-bold" id="navPoints">0</div>
                            </div>
                        </div>
                        
                        <!-- Level Display -->
                        <div class="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-lg">
                            <div class="w-8 h-8 gradient-primary rounded-lg flex items-center justify-center">
                                <i class="fas fa-trophy text-white"></i>
                            </div>
                            <div>
                                <div class="text-xs opacity-80">Level</div>
                                <div class="font-bold" id="navLevel">1</div>
                            </div>
                        </div>
                        
                        <!-- Platform Connections -->
                        <button onclick="openPlatformModal()" class="flex items-center gap-2 bg-white/5 hover:bg-white/10 px-4 py-2 rounded-lg transition">
                            <i class="fas fa-plug text-blue-400"></i>
                            <span class="hidden md:inline">Platforms</span>
                        </button>
                        
                        <!-- User Menu -->
                        <div class="relative group">
                            <button class="flex items-center gap-2 bg-white/5 hover:bg-white/10 px-3 py-2 rounded-lg transition">
                                <div class="w-8 h-8 gradient-primary rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-white"></i>
                                </div>
                                <div class="text-left hidden md:block">
                                    <div class="text-sm font-medium" id="navUserName">User</div>
                                    <div class="text-xs text-gray-400">Level <span id="navLevelBadge">1</span></div>
                                </div>
                                <i class="fas fa-chevron-down text-xs hidden md:block"></i>
                            </button>
                            
                            <div class="absolute right-0 mt-2 w-64 bg-gray-900 rounded-xl shadow-2xl border border-white/10 hidden group-hover:block">
                                <div class="p-4 border-b border-white/10">
                                    <div class="font-bold" id="dropdownUserName">User</div>
                                    <div class="text-sm text-gray-400" id="dropdownUserEmail">user@example.com</div>
                                    <div class="mt-3 flex items-center gap-2">
                                        <div class="flex-1 h-2 bg-gray-800 rounded-full overflow-hidden">
                                            <div id="userProgressBar" class="h-full gradient-primary rounded-full" style="width: 30%"></div>
                                        </div>
                                        <span class="text-xs">30%</span>
                                    </div>
                                </div>
                                
                                <div class="p-2">
                                    <button onclick="openPlatformModal()" class="w-full flex items-center gap-2 px-3 py-2 hover:bg-white/5 rounded-lg">
                                        <i class="fas fa-plug text-blue-400"></i>
                                        <span>Platform Connections</span>
                                    </button>
                                    <button onclick="showSettings()" class="w-full flex items-center gap-2 px-3 py-2 hover:bg-white/5 rounded-lg">
                                        <i class="fas fa-cog text-gray-400"></i>
                                        <span>Settings</span>
                                    </button>
                                    <div class="border-t border-white/10 my-1"></div>
                                    <button onclick="logout()" class="w-full flex items-center gap-2 px-3 py-2 hover:bg-red-500/10 rounded-lg text-red-400">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Logout</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto p-4">
            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="glass-effect rounded-xl p-4 card-hover stat-card border border-white/5">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 gradient-primary rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-xl text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Today's Focus</div>
                            <div class="text-2xl font-bold" id="todayFocus">0h 0m</div>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-4 card-hover stat-card border border-white/5">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 gradient-success rounded-lg flex items-center justify-center">
                            <i class="fas fa-fire text-xl text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Study Streak</div>
                            <div class="text-2xl font-bold" id="mainStreak">0 days</div>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-4 card-hover stat-card border border-white/5">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 gradient-warning rounded-lg flex items-center justify-center">
                            <i class="fab fa-leetcode text-xl text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">LeetCode Streak</div>
                            <div class="text-2xl font-bold" id="leetcodeStreak">0 days</div>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-4 card-hover stat-card border border-white/5">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 gradient-danger rounded-lg flex items-center justify-center">
                            <i class="fas fa-shield-alt text-xl text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">TryHackMe Streak</div>
                            <div class="text-2xl font-bold" id="tryhackmeStreak">0 days</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Left Column: Platform Dashboard -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Platform Dashboard -->
                    <div class="glass-effect rounded-2xl p-6 border border-white/5">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold flex items-center gap-2">
                                <i class="fas fa-code text-blue-400"></i> Platform Dashboard
                            </h2>
                            <button onclick="openPlatformModal()" class="text-sm bg-white/5 hover:bg-white/10 px-3 py-1 rounded-lg transition">
                                <i class="fas fa-cog mr-1"></i> Manage
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- GitHub Card -->
                            <div class="platform-card glass-effect rounded-xl p-5 border border-white/5 github-card">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center">
                                            <i class="fab fa-github text-xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold">GitHub</h3>
                                            <div class="text-xs text-gray-400" id="githubUsernameDisplay">Not connected</div>
                                        </div>
                                    </div>
                                    <button onclick="openGitHub()" class="bg-gray-800 hover:bg-gray-700 text-white px-3 py-1 rounded-lg text-sm transition">
                                        View
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="githubRepos">0</div>
                                        <div class="text-xs text-gray-400">Repositories</div>
                                    </div>
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="githubCommits">0</div>
                                        <div class="text-xs text-gray-400">Commits (30d)</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Activity</span>
                                    <span id="githubActivity">0%</span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full mt-1 overflow-hidden">
                                    <div id="githubActivityBar" class="h-full bg-gray-600 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>

                            <!-- LeetCode Card -->
                            <div class="platform-card glass-effect rounded-xl p-5 border border-white/5 leetcode-card">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-amber-500 rounded-lg flex items-center justify-center">
                                            <i class="fab fa-leetcode text-xl text-white"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold">LeetCode</h3>
                                            <div class="text-xs text-gray-400" id="leetcodeUsernameDisplay">Not connected</div>
                                        </div>
                                    </div>
                                    <button onclick="openLeetCode()" class="bg-gradient-to-r from-orange-600 to-amber-600 hover:opacity-90 text-white px-3 py-1 rounded-lg text-sm transition">
                                        Solve
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="leetcodeSolved">0</div>
                                        <div class="text-xs text-gray-400">Solved</div>
                                    </div>
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="leetcodeRating">0</div>
                                        <div class="text-xs text-gray-400">Rating</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Rank</span>
                                    <span id="leetcodeRank">Not ranked</span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full mt-1 overflow-hidden">
                                    <div id="leetcodeProgressBar" class="h-full bg-gradient-to-r from-orange-500 to-amber-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>

                            <!-- TryHackMe Card -->
                            <div class="platform-card glass-effect rounded-xl p-5 border border-white/5 tryhackme-card">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-shield-alt text-xl text-white"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold">TryHackMe</h3>
                                            <div class="text-xs text-gray-400" id="tryhackmeUsernameDisplay">Not connected</div>
                                        </div>
                                    </div>
                                    <button onclick="openTryHackMe()" class="bg-gradient-to-r from-red-600 to-pink-600 hover:opacity-90 text-white px-3 py-1 rounded-lg text-sm transition">
                                        Practice
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="tryhackmeRooms">0</div>
                                        <div class="text-xs text-gray-400">Rooms</div>
                                    </div>
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="tryhackmePoints">0</div>
                                        <div class="text-xs text-gray-400">Points</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Rank</span>
                                    <span id="tryhackmeRank">Beginner</span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full mt-1 overflow-hidden">
                                    <div id="tryhackmeProgressBar" class="h-full bg-gradient-to-r from-red-500 to-pink-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>

                            <!-- Codeforces Card -->
                            <div class="platform-card glass-effect rounded-xl p-5 border border-white/5 codeforces-card">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-chart-line text-xl text-white"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold">Codeforces</h3>
                                            <div class="text-xs text-gray-400" id="codeforcesUsernameDisplay">Not connected</div>
                                        </div>
                                    </div>
                                    <button onclick="openCodeforces()" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:opacity-90 text-white px-3 py-1 rounded-lg text-sm transition">
                                        Compete
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="codeforcesRating">0</div>
                                        <div class="text-xs text-gray-400">Rating</div>
                                    </div>
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="text-2xl font-bold" id="codeforcesContests">0</div>
                                        <div class="text-xs text-gray-400">Contests</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Rank</span>
                                    <span id="codeforcesRank">Newbie</span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full mt-1 overflow-hidden">
                                    <div id="codeforcesProgressBar" class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Study Session Starter -->
                    <div class="glass-effect rounded-2xl p-6 border border-white/5">
                        <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                            <i class="fas fa-play-circle text-green-400"></i> Start Study Session
                        </h2>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">What are you studying?</label>
                                <input type="text" id="sessionTopic" 
                                       class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                                       placeholder="e.g., Array Problems, Dynamic Programming, Web Security">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Duration (minutes)</label>
                                    <div class="grid grid-cols-4 gap-2 mb-2">
                                        <button onclick="setDuration(25)" class="py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">25</button>
                                        <button onclick="setDuration(45)" class="py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">45</button>
                                        <button onclick="setDuration(60)" class="py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">60</button>
                                        <button onclick="setDuration(90)" class="py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">90</button>
                                    </div>
                                    <input type="number" id="sessionDuration" value="25" min="1"
                                           class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Platform</label>
                                    <select id="sessionPlatform" 
                                            class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus">
                                        <option value="">Select Platform</option>
                                        <option value="leetcode">LeetCode</option>
                                        <option value="tryhackme">TryHackMe</option>
                                        <option value="codeforces">Codeforces</option>
                                        <option value="github">GitHub</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Notes (Optional)</label>
                                <textarea id="sessionNotes" rows="3"
                                          class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white input-focus"
                                          placeholder="What are you working on? Any specific goals?"></textarea>
                            </div>
                            
                            <button onclick="startStudySession()" class="w-full gradient-success text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition">
                                <i class="fas fa-play mr-2"></i> Start Session
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Stats & Streaks -->
                <div class="space-y-6">
                    <!-- Weekly Progress -->
                    <div class="glass-effect rounded-2xl p-6 border border-white/5">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-lg flex items-center gap-2">
                                <i class="fas fa-chart-line text-yellow-400"></i> Weekly Progress
                            </h3>
                            <div class="text-sm text-gray-400" id="weeklyPoints">0 points</div>
                        </div>
                        
                        <div class="mb-6">
                            <canvas id="weeklyChart" height="200"></canvas>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Points Progress</span>
                                    <span id="pointsProgressText">0/1000</span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                    <div id="pointsProgressBar" class="h-full gradient-warning rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Level Progress</span>
                                    <span id="levelProgressText">0%</span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                    <div id="levelProgressBar" class="h-full gradient-primary rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Streak Calendar -->
                    <div class="glass-effect rounded-2xl p-6 border border-white/5">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-lg flex items-center gap-2">
                                <i class="fas fa-fire text-orange-400"></i> Streak Calendar
                            </h3>
                            <div class="text-sm font-bold text-green-400" id="currentStreak">0 days</div>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-1 mb-4">
                            <!-- Days of the week -->
                            <div class="text-center text-xs text-gray-400">M</div>
                            <div class="text-center text-xs text-gray-400">T</div>
                            <div class="text-center text-xs text-gray-400">W</div>
                            <div class="text-center text-xs text-gray-400">T</div>
                            <div class="text-center text-xs text-gray-400">F</div>
                            <div class="text-center text-xs text-gray-400">S</div>
                            <div class="text-center text-xs text-gray-400">S</div>
                            
                            <!-- Streak dots will be populated here -->
                            <div id="streakCalendar" class="col-span-7 grid grid-cols-7 gap-1">
                                <!-- JavaScript will populate this -->
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm text-gray-400">
                            <div class="flex items-center gap-2">
                                <div class="streak-dot inactive"></div>
                                <span>No activity</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="streak-dot active"></div>
                                <span>Active</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Sessions -->
                    <div class="glass-effect rounded-2xl p-6 border border-white/5">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i class="fas fa-history text-blue-400"></i> Recent Sessions
                        </h3>
                        
                        <div id="recentSessions" class="space-y-3 max-h-64 overflow-y-auto scrollbar-thin">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-clock text-2xl mb-2 opacity-30"></i>
                                <p class="text-sm">No sessions yet</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="glass-effect rounded-2xl p-6 border border-white/5">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i class="fas fa-bolt text-purple-400"></i> Quick Actions
                        </h3>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="logLeetCode()" class="bg-gradient-to-r from-orange-500/20 to-amber-500/20 border border-orange-500/30 text-orange-400 px-3 py-2 rounded-lg hover:bg-orange-500/30 transition">
                                <i class="fab fa-leetcode mr-2"></i>Log Problem
                            </button>
                            <button onclick="logTryHackMe()" class="bg-gradient-to-r from-red-500/20 to-pink-500/20 border border-red-500/30 text-red-400 px-3 py-2 rounded-lg hover:bg-red-500/30 transition">
                                <i class="fas fa-shield-alt mr-2"></i>Log Room
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Achievements -->
            <div class="glass-effect rounded-2xl p-6 mb-6 border border-white/5">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-2">
                        <i class="fas fa-trophy text-yellow-400"></i> Achievements
                    </h2>
                    <div class="text-sm text-gray-400" id="achievementsCount">0 unlocked</div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="achievementsGrid">
                    <!-- Achievements will be populated by JavaScript -->
                </div>
            </div>

            <!-- Session History -->
            <div class="glass-effect rounded-2xl p-6 border border-white/5">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <i class="fas fa-list-alt text-green-400"></i> Session History
                </h2>
                
                <div class="overflow-x-auto scrollbar-thin">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-400 border-b border-white/10">
                                <th class="pb-3 font-medium">Date</th>
                                <th class="pb-3 font-medium">Topic</th>
                                <th class="pb-3 font-medium">Platform</th>
                                <th class="pb-3 font-medium">Duration</th>
                                <th class="pb-3 font-medium">Points</th>
                                <th class="pb-3 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sessionHistory">
                            <tr>
                                <td colspan="6" class="py-8 text-center text-gray-500">
                                    <i class="fas fa-history text-2xl mb-2 opacity-30"></i>
                                    <p>No sessions recorded yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Timer Modal -->
    <div id="timerModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 max-w-md w-full border border-white/10">
            <div class="text-center mb-6">
                <div class="text-5xl font-bold font-mono mb-4 glow" id="timerDisplay">25:00</div>
                <div class="text-lg text-gray-300 mb-2" id="timerTopic">Focus Session</div>
                <div class="text-sm text-gray-400" id="timerPlatform">No platform</div>
            </div>
            
            <div class="grid grid-cols-3 gap-3 mb-6">
                <button onclick="startTimer()" id="startTimerBtn" class="gradient-success text-white py-3 rounded-lg hover:opacity-90 transition">
                    <i class="fas fa-play mr-2"></i>Start
                </button>
                <button onclick="pauseTimer()" id="pauseTimerBtn" class="gradient-warning text-white py-3 rounded-lg hover:opacity-90 transition hidden">
                    <i class="fas fa-pause mr-2"></i>Pause
                </button>
                <button onclick="resetTimer()" id="resetTimerBtn" class="gradient-danger text-white py-3 rounded-lg hover:opacity-90 transition">
                    <i class="fas fa-stop mr-2"></i>Reset
                </button>
            </div>
            
            <div class="flex items-center justify-center gap-4 mb-6">
                <button onclick="setTimerDuration(25)" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition">25 min</button>
                <button onclick="setTimerDuration(45)" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition">45 min</button>
                <button onclick="setTimerDuration(60)" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition">60 min</button>
            </div>
            
            <div class="p-4 bg-white/5 rounded-xl">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-sm text-gray-400">Session</div>
                        <div class="text-lg font-bold" id="timerSessionCount">1/4</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400">Break</div>
                        <div class="text-lg font-bold" id="timerBreakTime">5:00</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400">Focus</div>
                        <div class="text-lg font-bold" id="timerFocusPercent">100%</div>
                    </div>
                </div>
            </div>
            
            <button onclick="closeTimerModal()" class="w-full mt-6 bg-gray-800 hover:bg-gray-700 text-white py-3 rounded-lg transition">
                Close Timer
            </button>
        </div>
    </div>

    <!-- LeetCode Log Modal -->
    <div id="leetcodeModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 max-w-md w-full border border-white/10">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                <i class="fab fa-leetcode text-orange-400"></i> Log LeetCode Problem
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Problem Name</label>
                    <input type="text" id="leetcodeProblem" 
                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus"
                           placeholder="e.g., Two Sum">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Difficulty</label>
                        <select id="leetcodeDifficulty" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Time (min)</label>
                        <input type="number" id="leetcodeTime" value="30" min="1"
                               class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Notes</label>
                    <textarea id="leetcodeNotes" rows="2"
                              class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus"
                              placeholder="Any insights or challenges?"></textarea>
                </div>
            </div>

            <div class="flex gap-2 mt-8">
                <button onclick="submitLeetCode()" class="flex-1 gradient-warning text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                    <i class="fas fa-check mr-2"></i>Submit
                </button>
                <button onclick="closeLeetCodeModal()" class="flex-1 bg-gray-800 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- TryHackMe Log Modal -->
    <div id="tryhackmeModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 max-w-md w-full border border-white/10">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                <i class="fas fa-shield-alt text-red-400"></i> Log TryHackMe Room
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Room Name</label>
                    <input type="text" id="thmRoom" 
                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus"
                           placeholder="e.g., Introductory Networking">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Difficulty</label>
                        <select id="thmDifficulty" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                            <option value="insane">Insane</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Time (min)</label>
                        <input type="number" id="thmTime" value="60" min="1"
                               class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white input-focus">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Progress (%)</label>
                    <input type="range" id="thmProgress" min="0" max="100" value="100"
                           class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-sm text-gray-400">
                        <span>0%</span>
                        <span id="thmProgressValue">100%</span>
                        <span>100%</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-2 mt-8">
                <button onclick="submitTryHackMe()" class="flex-1 gradient-danger text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                    <i class="fas fa-check mr-2"></i>Submit
                </button>
                <button onclick="closeTryHackMeModal()" class="flex-1 bg-gray-800 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize toastr
        toastr.options = {
            "positionClass": "toast-top-right",
            "progressBar": true,
            "timeOut": "4000",
            "closeButton": true
        };

        // Global state
        let currentUser = null;
        let state = {
            users: {},
            timer: {
                active: false,
                timeLeft: 25 * 60,
                duration: 25 * 60,
                interval: null,
                session: 1,
                isBreak: false,
                topic: '',
                platform: ''
            },
            weeklyChart: null,
            platformData: {
                github: null,
                leetcode: null,
                tryhackme: null,
                codeforces: null
            }
        };

        // Initialize app
        function init() {
            loadData();
            checkFirstVisit();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('codeflow_user');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                if (state.users[userData.email]) {
                    currentUser = state.users[userData.email];
                    showDashboard();
                }
            }
        }

        // Check if first visit
        function checkFirstVisit() {
            if (!localStorage.getItem('codeflow_first_visit')) {
                setTimeout(() => {
                    document.getElementById('welcomeModal').classList.remove('hidden');
                }, 1000);
                localStorage.setItem('codeflow_first_visit', 'true');
            }
        }

        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.add('hidden');
        }

        // Data persistence
        function loadData() {
            const saved = localStorage.getItem('codeflow_data');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('codeflow_data', JSON.stringify(state));
        }

        function saveUserData() {
            if (currentUser) {
                state.users[currentUser.email] = currentUser;
                localStorage.setItem('codeflow_user', JSON.stringify({
                    email: currentUser.email,
                    name: currentUser.firstName
                }));
                saveData();
            }
        }

        // Authentication
        function switchAuthTab(tab) {
            const loginBtn = document.getElementById('loginTabBtn');
            const registerBtn = document.getElementById('registerTabBtn');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (tab === 'login') {
                loginBtn.classList.add('tab-active');
                loginBtn.classList.remove('text-gray-400');
                registerBtn.classList.remove('tab-active');
                registerBtn.classList.add('text-gray-400');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerBtn.classList.add('tab-active');
                registerBtn.classList.remove('text-gray-400');
                loginBtn.classList.remove('tab-active');
                loginBtn.classList.add('text-gray-400');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePassword(password) {
            return password.length >= 8 && /\d/.test(password) && /[a-zA-Z]/.test(password);
        }

        function register() {
            const firstName = document.getElementById('registerFirstName').value.trim();
            const lastName = document.getElementById('registerLastName').value.trim();
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const acceptTerms = document.getElementById('acceptTerms').checked;

            // Validation
            if (!firstName || !lastName || !email || !password || !confirmPassword) {
                toastr.error('Please fill in all fields');
                return;
            }

            if (!validateEmail(email)) {
                toastr.error('Please enter a valid email address');
                return;
            }

            if (!validatePassword(password)) {
                toastr.error('Password must be at least 8 characters with letters and numbers');
                return;
            }

            if (password !== confirmPassword) {
                toastr.error('Passwords do not match');
                return;
            }

            if (!acceptTerms) {
                toastr.error('Please accept the terms and conditions');
                return;
            }

            // Check if user exists
            if (state.users[email]) {
                toastr.error('An account with this email already exists');
                return;
            }

            // Create user
            const userId = Date.now().toString();
            const userData = {
                id: userId,
                firstName,
                lastName,
                email,
                password: btoa(password),
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                points: 0,
                level: 1,
                experience: 0,
                totalStudyTime: 0,
                sessionsCompleted: 0,
                platformConnections: {
                    github: '',
                    leetcode: '',
                    tryhackme: '',
                    codeforces: ''
                },
                platformStats: {
                    github: { repos: 0, commits: 0, followers: 0 },
                    leetcode: { solved: 0, rating: 0, streak: 0, rank: '' },
                    tryhackme: { rooms: 0, points: 0, rank: '', streak: 0 },
                    codeforces: { rating: 0, contests: 0, rank: '', maxRating: 0 }
                },
                streaks: {
                    main: { current: 0, longest: 0, lastUpdated: null },
                    leetcode: { current: 0, longest: 0, lastUpdated: null },
                    tryhackme: { current: 0, longest: 0, lastUpdated: null }
                },
                sessions: [],
                achievements: [],
                activity: [],
                settings: {
                    theme: 'dark',
                    notifications: true,
                    autoStartTimer: true,
                    dailyGoal: 4,
                    weeklyGoal: 20
                }
            };

            state.users[email] = userData;
            saveData();
            
            // Auto login
            loginUser(email, password);
            
            toastr.success(`Welcome ${firstName}! Your account has been created.`);
        }

        function login() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            
            loginUser(email, password);
        }

        function loginUser(email, password) {
            const user = state.users[email];
            
            if (!user) {
                toastr.error('No account found with this email');
                return;
            }

            if (btoa(password) !== user.password) {
                toastr.error('Incorrect password');
                return;
            }

            // Update last login
            user.lastLogin = new Date().toISOString();
            
            currentUser = user;
            saveUserData();
            showDashboard();
            
            // Welcome message
            const hour = new Date().getHours();
            let greeting = 'Good evening';
            if (hour < 12) greeting = 'Good morning';
            else if (hour < 18) greeting = 'Good afternoon';
            
            setTimeout(() => {
                toastr.success(`${greeting}, ${user.firstName}! Ready to code?`);
            }, 500);
        }

        function logout() {
            if (state.timer.active) {
                clearInterval(state.timer.interval);
                state.timer.active = false;
            }
            
            currentUser = null;
            localStorage.removeItem('codeflow_user');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
            
            toastr.info('Logged out successfully');
        }

        // Dashboard functions
        function showDashboard() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            updateDashboard();
            initWeeklyChart();
            
            // Load platform data
            loadPlatformData();
        }

        function updateDashboard() {
            if (!currentUser) return;

            // Update user info
            document.getElementById('navUserName').textContent = currentUser.firstName;
            document.getElementById('navPoints').textContent = currentUser.points;
            document.getElementById('navLevel').textContent = currentUser.level;
            document.getElementById('navLevelBadge').textContent = currentUser.level;
            document.getElementById('userGreeting').textContent = `Welcome back, ${currentUser.firstName}!`;
            document.getElementById('dropdownUserName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('dropdownUserEmail').textContent = currentUser.email;

            // Update progress
            const levelProgress = Math.min(100, (currentUser.experience / (currentUser.level * 1000)) * 100);
            document.getElementById('userProgressBar').style.width = `${levelProgress}%`;
            document.getElementById('levelProgressText').textContent = `${Math.floor(levelProgress)}%`;
            document.getElementById('levelProgressBar').style.width = `${levelProgress}%`;

            // Update points progress
            const pointsProgress = Math.min(100, (currentUser.points / 1000) * 100);
            document.getElementById('pointsProgressText').textContent = `${currentUser.points}/1000`;
            document.getElementById('pointsProgressBar').style.width = `${pointsProgress}%`;

            // Update streaks
            document.getElementById('mainStreak').textContent = `${currentUser.streaks.main.current} days`;
            document.getElementById('leetcodeStreak').textContent = `${currentUser.streaks.leetcode.current} days`;
            document.getElementById('tryhackmeStreak').textContent = `${currentUser.streaks.tryhackme.current} days`;
            document.getElementById('currentStreak').textContent = `${currentUser.streaks.main.current} days`;

            // Update platform connections display
            updatePlatformConnectionsDisplay();

            // Update today's focus
            updateTodayFocus();
            
            // Update streak calendar
            renderStreakCalendar();
            
            // Update recent sessions
            renderRecentSessions();
            
            // Update session history
            renderSessionHistory();
            
            // Update achievements
            renderAchievements();
            
            // Update weekly progress
            updateWeeklyProgress();
        }

        // Platform Integration
        function openPlatformModal() {
            const connections = currentUser.platformConnections;
            
            document.getElementById('githubUsername').value = connections.github || '';
            document.getElementById('leetcodeUsername').value = connections.leetcode || '';
            document.getElementById('tryhackmeUsername').value = connections.tryhackme || '';
            document.getElementById('codeforcesUsername').value = connections.codeforces || '';
            
            document.getElementById('platformModal').classList.remove('hidden');
        }

        function closePlatformModal() {
            document.getElementById('platformModal').classList.add('hidden');
        }

        async function connectGitHub() {
            const username = document.getElementById('githubUsername').value.trim();
            if (!username) {
                toastr.error('Please enter a GitHub username');
                return;
            }

            // Simulate API call
            toastr.info('Connecting to GitHub...');
            
            // Mock data for demo
            const mockData = {
                repos: Math.floor(Math.random() * 50) + 10,
                commits: Math.floor(Math.random() * 200) + 50,
                followers: Math.floor(Math.random() * 100) + 10,
                activity: Math.floor(Math.random() * 100)
            };

            currentUser.platformConnections.github = username;
            currentUser.platformStats.github = mockData;
            saveUserData();
            
            updatePlatformConnectionsDisplay();
            toastr.success(`GitHub connected: ${username}`);
        }

        async function connectLeetCode() {
            const username = document.getElementById('leetcodeUsername').value.trim();
            if (!username) {
                toastr.error('Please enter a LeetCode username');
                return;
            }

            toastr.info('Connecting to LeetCode...');
            
            const mockData = {
                solved: Math.floor(Math.random() * 300) + 50,
                rating: Math.floor(Math.random() * 2500) + 1000,
                streak: Math.floor(Math.random() * 30),
                rank: ['Beginner', 'Intermediate', 'Advanced'][Math.floor(Math.random() * 3)]
            };

            currentUser.platformConnections.leetcode = username;
            currentUser.platformStats.leetcode = mockData;
            saveUserData();
            
            updatePlatformConnectionsDisplay();
            toastr.success(`LeetCode connected: ${username}`);
        }

        async function connectTryHackMe() {
            const username = document.getElementById('tryhackmeUsername').value.trim();
            if (!username) {
                toastr.error('Please enter a TryHackMe username');
                return;
            }

            toastr.info('Connecting to TryHackMe...');
            
            const mockData = {
                rooms: Math.floor(Math.random() * 50) + 5,
                points: Math.floor(Math.random() * 10000) + 1000,
                rank: ['Beginner', 'Hacker', 'Expert', 'Master'][Math.floor(Math.random() * 4)],
                streak: Math.floor(Math.random() * 15)
            };

            currentUser.platformConnections.tryhackme = username;
            currentUser.platformStats.tryhackme = mockData;
            saveUserData();
            
            updatePlatformConnectionsDisplay();
            toastr.success(`TryHackMe connected: ${username}`);
        }

        async function connectCodeforces() {
            const username = document.getElementById('codeforcesUsername').value.trim();
            if (!username) {
                toastr.error('Please enter a Codeforces handle');
                return;
            }

            toastr.info('Connecting to Codeforces...');
            
            const mockData = {
                rating: Math.floor(Math.random() * 2500) + 1000,
                contests: Math.floor(Math.random() * 100) + 10,
                rank: ['Newbie', 'Pupil', 'Specialist', 'Expert'][Math.floor(Math.random() * 4)],
                maxRating: Math.floor(Math.random() * 3000) + 1500
            };

            currentUser.platformConnections.codeforces = username;
            currentUser.platformStats.codeforces = mockData;
            saveUserData();
            
            updatePlatformConnectionsDisplay();
            toastr.success(`Codeforces connected: ${username}`);
        }

        function savePlatformConnections() {
            saveUserData();
            closePlatformModal();
            toastr.success('Platform connections saved!');
        }

        function updatePlatformConnectionsDisplay() {
            const connections = currentUser.platformConnections;
            const stats = currentUser.platformStats;

            // GitHub
            const githubConnected = !!connections.github;
            document.getElementById('githubUsernameDisplay').textContent = 
                githubConnected ? connections.github : 'Not connected';
            
            if (githubConnected && stats.github) {
                document.getElementById('githubRepos').textContent = stats.github.repos;
                document.getElementById('githubCommits').textContent = stats.github.commits;
                document.getElementById('githubActivity').textContent = `${stats.github.activity}%`;
                document.getElementById('githubActivityBar').style.width = `${stats.github.activity}%`;
            }

            // LeetCode
            const leetcodeConnected = !!connections.leetcode;
            document.getElementById('leetcodeUsernameDisplay').textContent = 
                leetcodeConnected ? connections.leetcode : 'Not connected';
            
            if (leetcodeConnected && stats.leetcode) {
                document.getElementById('leetcodeSolved').textContent = stats.leetcode.solved;
                document.getElementById('leetcodeRating').textContent = stats.leetcode.rating;
                document.getElementById('leetcodeRank').textContent = stats.leetcode.rank;
                const leetcodeProgress = Math.min(100, (stats.leetcode.solved / 500) * 100);
                document.getElementById('leetcodeProgressBar').style.width = `${leetcodeProgress}%`;
            }

            // TryHackMe
            const thmConnected = !!connections.tryhackme;
            document.getElementById('tryhackmeUsernameDisplay').textContent = 
                thmConnected ? connections.tryhackme : 'Not connected';
            
            if (thmConnected && stats.tryhackme) {
                document.getElementById('tryhackmeRooms').textContent = stats.tryhackme.rooms;
                document.getElementById('tryhackmePoints').textContent = stats.tryhackme.points.toLocaleString();
                document.getElementById('tryhackmeRank').textContent = stats.tryhackme.rank;
                const thmProgress = Math.min(100, (stats.tryhackme.rooms / 100) * 100);
                document.getElementById('tryhackmeProgressBar').style.width = `${thmProgress}%`;
            }

            // Codeforces
            const cfConnected = !!connections.codeforces;
            document.getElementById('codeforcesUsernameDisplay').textContent = 
                cfConnected ? connections.codeforces : 'Not connected';
            
            if (cfConnected && stats.codeforces) {
                document.getElementById('codeforcesRating').textContent = stats.codeforces.rating;
                document.getElementById('codeforcesContests').textContent = stats.codeforces.contests;
                document.getElementById('codeforcesRank').textContent = stats.codeforces.rank;
                const cfProgress = Math.min(100, (stats.codeforces.rating / 3000) * 100);
                document.getElementById('codeforcesProgressBar').style.width = `${cfProgress}%`;
            }
        }

        function loadPlatformData() {
            // This would fetch real data from APIs
            updatePlatformConnectionsDisplay();
        }

        // Platform Redirects
        function openGitHub() {
            const username = currentUser.platformConnections.github;
            if (username) {
                window.open(`https://github.com/${username}`, '_blank');
            } else {
                toastr.info('Please connect your GitHub account first');
                openPlatformModal();
            }
        }

        function openLeetCode() {
            const username = currentUser.platformConnections.leetcode;
            if (username) {
                window.open(`https://leetcode.com/${username}`, '_blank');
            } else {
                toastr.info('Please connect your LeetCode account first');
                openPlatformModal();
            }
        }

        function openTryHackMe() {
            const username = currentUser.platformConnections.tryhackme;
            if (username) {
                window.open(`https://tryhackme.com/p/${username}`, '_blank');
            } else {
                toastr.info('Please connect your TryHackMe account first');
                openPlatformModal();
            }
        }

        function openCodeforces() {
            const username = currentUser.platformConnections.codeforces;
            if (username) {
                window.open(`https://codeforces.com/profile/${username}`, '_blank');
            } else {
                toastr.info('Please connect your Codeforces account first');
                openPlatformModal();
            }
        }

        // Study Session Management
        function setDuration(minutes) {
            document.getElementById('sessionDuration').value = minutes;
        }

        function startStudySession() {
            const topic = document.getElementById('sessionTopic').value.trim();
            const duration = parseInt(document.getElementById('sessionDuration').value) || 25;
            const platform = document.getElementById('sessionPlatform').value;
            const notes = document.getElementById('sessionNotes').value.trim();

            if (!topic) {
                toastr.error('Please enter what you are studying');
                return;
            }

            // Start timer
            state.timer.topic = topic;
            state.timer.platform = platform;
            state.timer.duration = duration * 60;
            state.timer.timeLeft = duration * 60;
            
            document.getElementById('timerTopic').textContent = topic;
            document.getElementById('timerPlatform').textContent = platform || 'No platform';
            document.getElementById('timerDisplay').textContent = formatTime(state.timer.timeLeft);
            
            document.getElementById('timerModal').classList.remove('hidden');
            startTimer();
        }

        function closeTimerModal() {
            if (state.timer.active) {
                pauseTimer();
            }
            document.getElementById('timerModal').classList.add('hidden');
        }

        // Timer functions
        function setTimerDuration(minutes) {
            state.timer.timeLeft = minutes * 60;
            state.timer.duration = minutes * 60;
            updateTimerDisplay();
        }

        function startTimer() {
            if (state.timer.active) return;

            state.timer.active = true;
            state.timer.interval = setInterval(updateTimer, 1000);
            
            document.getElementById('startTimerBtn').classList.add('hidden');
            document.getElementById('pauseTimerBtn').classList.remove('hidden');
            
            toastr.info('Focus timer started! ðŸŽ¯');
        }

        function pauseTimer() {
            if (!state.timer.active) return;

            state.timer.active = false;
            clearInterval(state.timer.interval);
            
            document.getElementById('startTimerBtn').classList.remove('hidden');
            document.getElementById('pauseTimerBtn').classList.add('hidden');
            
            toastr.info('Timer paused');
        }

        function resetTimer() {
            state.timer.active = false;
            clearInterval(state.timer.interval);
            state.timer.timeLeft = state.timer.duration;
            state.timer.session = 1;
            state.timer.isBreak = false;
            
            document.getElementById('startTimerBtn').classList.remove('hidden');
            document.getElementById('pauseTimerBtn').classList.add('hidden');
            updateTimerDisplay();
            
            toastr.info('Timer reset');
        }

        function updateTimer() {
            state.timer.timeLeft--;
            
            if (state.timer.timeLeft <= 0) {
                if (state.timer.isBreak) {
                    // Break finished
                    state.timer.isBreak = false;
                    state.timer.timeLeft = state.timer.duration;
                    state.timer.session++;
                    
                    if (state.timer.session > 4) {
                        toastr.success('ðŸŽ‰ Completed 4 focus sessions! Take a longer break.');
                        resetTimer();
                        completeSession();
                        return;
                    } else {
                        toastr.info('Break finished! Back to work.');
                    }
                } else {
                    // Work session finished
                    state.timer.isBreak = true;
                    state.timer.timeLeft = 5 * 60; // 5 minute break
                    
                    toastr.success('Great work! Time for a 5-minute break.');
                }
            }
            
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            document.getElementById('timerDisplay').textContent = formatTime(state.timer.timeLeft);
            document.getElementById('timerSessionCount').textContent = `${state.timer.session}/4`;
            
            if (state.timer.isBreak) {
                document.getElementById('timerBreakTime').textContent = formatTime(state.timer.timeLeft);
                document.getElementById('timerFocusPercent').textContent = 'Break';
            } else {
                document.getElementById('timerBreakTime').textContent = '5:00';
                const focusPercent = Math.min(100, Math.floor((1 - state.timer.timeLeft / state.timer.duration) * 100));
                document.getElementById('timerFocusPercent').textContent = `${focusPercent}%`;
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function completeSession() {
            const duration = state.timer.duration / 60;
            const pointsEarned = Math.floor(duration / 5) * 10;
            const timestamp = new Date().toISOString();
            
            const session = {
                id: Date.now(),
                topic: state.timer.topic,
                platform: state.timer.platform,
                duration: duration,
                points: pointsEarned,
                timestamp: timestamp,
                date: new Date().toLocaleDateString()
            };

            currentUser.sessions.unshift(session);
            currentUser.points += pointsEarned;
            currentUser.experience += pointsEarned;
            currentUser.totalStudyTime += duration;
            currentUser.sessionsCompleted++;

            // Update streak
            updateStreak('main');

            // Add to activity
            currentUser.activity.unshift({
                type: 'session',
                topic: state.timer.topic,
                duration: duration,
                points: pointsEarned,
                timestamp: timestamp
            });

            // Check for level up
            checkLevelUp();

            saveUserData();
            updateDashboard();
            
            toastr.success(`Session completed! +${pointsEarned} points earned`);
            
            if (pointsEarned >= 100) {
                triggerConfetti();
            }
        }

        // Streak management
        function updateStreak(type) {
            const today = new Date().toISOString().split('T')[0];
            const streak = currentUser.streaks[type];
            
            if (!streak.lastUpdated || streak.lastUpdated !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                
                if (streak.lastUpdated === yesterdayStr) {
                    streak.current++;
                } else {
                    streak.current = 1;
                }
                
                streak.lastUpdated = today;
                streak.longest = Math.max(streak.longest, streak.current);
            }
        }

        function renderStreakCalendar() {
            const container = document.getElementById('streakCalendar');
            const streak = currentUser.streaks.main;
            
            let html = '';
            const today = new Date();
            
            // Generate 28 days (4 weeks)
            for (let i = 27; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                let isActive = false;
                if (streak.lastUpdated) {
                    // Simple logic: mark as active if we have activity
                    isActive = Math.random() > 0.5; // Replace with actual activity check
                }
                
                const isToday = i === 0;
                
                html += `<div class="streak-dot ${isActive ? 'active' : 'inactive'} ${isToday ? 'today' : ''}"></div>`;
            }
            
            container.innerHTML = html;
        }

        // LeetCode logging
        function logLeetCode() {
            document.getElementById('leetcodeModal').classList.remove('hidden');
        }

        function closeLeetCodeModal() {
            document.getElementById('leetcodeModal').classList.add('hidden');
        }

        function submitLeetCode() {
            const problem = document.getElementById('leetcodeProblem').value.trim();
            const difficulty = document.getElementById('leetcodeDifficulty').value;
            const time = parseInt(document.getElementById('leetcodeTime').value) || 30;
            const notes = document.getElementById('leetcodeNotes').value.trim();

            if (!problem) {
                toastr.error('Please enter problem name');
                return;
            }

            const pointsMap = { easy: 25, medium: 50, hard: 100 };
            const pointsEarned = pointsMap[difficulty] || 25;
            const timestamp = new Date().toISOString();

            // Update LeetCode stats
            if (currentUser.platformStats.leetcode) {
                currentUser.platformStats.leetcode.solved++;
            }

            // Update points and streaks
            currentUser.points += pointsEarned;
            currentUser.experience += pointsEarned;
            updateStreak('leetcode');

            // Add to activity
            currentUser.activity.unshift({
                type: 'leetcode',
                problem: problem,
                difficulty: difficulty,
                points: pointsEarned,
                timestamp: timestamp
            });

            // Add to sessions
            currentUser.sessions.unshift({
                id: Date.now(),
                topic: `LeetCode: ${problem}`,
                platform: 'leetcode',
                duration: time,
                points: pointsEarned,
                timestamp: timestamp,
                date: new Date().toLocaleDateString()
            });

            checkLevelUp();
            saveUserData();
            updateDashboard();

            document.getElementById('leetcodeProblem').value = '';
            document.getElementById('leetcodeNotes').value = '';
            closeLeetCodeModal();

            toastr.success(`LeetCode problem logged! +${pointsEarned} points`);

            if (difficulty === 'hard') {
                triggerConfetti();
            }
        }

        // TryHackMe logging
        function logTryHackMe() {
            document.getElementById('tryhackmeModal').classList.remove('hidden');
            document.getElementById('thmProgressValue').textContent = '100%';
        }

        function closeTryHackMeModal() {
            document.getElementById('tryhackmeModal').classList.add('hidden');
        }

        function submitTryHackMe() {
            const room = document.getElementById('thmRoom').value.trim();
            const difficulty = document.getElementById('thmDifficulty').value;
            const time = parseInt(document.getElementById('thmTime').value) || 60;
            const progress = parseInt(document.getElementById('thmProgress').value);

            if (!room) {
                toastr.error('Please enter room name');
                return;
            }

            const pointsMap = { easy: 50, medium: 100, hard: 200, insane: 300 };
            const basePoints = pointsMap[difficulty] || 50;
            const pointsEarned = Math.floor(basePoints * (progress / 100));
            const timestamp = new Date().toISOString();

            // Update TryHackMe stats
            if (currentUser.platformStats.tryhackme) {
                currentUser.platformStats.tryhackme.rooms++;
                currentUser.platformStats.tryhackme.points += pointsEarned;
            }

            // Update points and streaks
            currentUser.points += pointsEarned;
            currentUser.experience += pointsEarned;
            updateStreak('tryhackme');

            // Add to activity
            currentUser.activity.unshift({
                type: 'tryhackme',
                room: room,
                difficulty: difficulty,
                progress: progress,
                points: pointsEarned,
                timestamp: timestamp
            });

            // Add to sessions
            currentUser.sessions.unshift({
                id: Date.now(),
                topic: `TryHackMe: ${room}`,
                platform: 'tryhackme',
                duration: time,
                points: pointsEarned,
                timestamp: timestamp,
                date: new Date().toLocaleDateString()
            });

            checkLevelUp();
            saveUserData();
            updateDashboard();

            document.getElementById('thmRoom').value = '';
            closeTryHackMeModal();

            toastr.success(`TryHackMe room logged! +${pointsEarned} points`);

            if (pointsEarned >= 200) {
                triggerConfetti();
            }
        }

        // Update THM progress value
        document.getElementById('thmProgress').addEventListener('input', function() {
            document.getElementById('thmProgressValue').textContent = `${this.value}%`;
        });

        // Level system
        function checkLevelUp() {
            const levelThreshold = currentUser.level * 1000;
            
            if (currentUser.experience >= levelThreshold) {
                currentUser.level++;
                currentUser.experience -= levelThreshold;
                
                document.getElementById('navLevel').classList.add('level-up');
                setTimeout(() => {
                    document.getElementById('navLevel').classList.remove('level-up');
                }, 500);
                
                toastr.success(`ðŸŽ‰ Level Up! You're now level ${currentUser.level}`);
                triggerConfetti();
            }
        }

        // Weekly chart
        function initWeeklyChart() {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            state.weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        {
                            label: 'Points',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            backgroundColor: 'rgba(99, 102, 241, 0.7)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 1,
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }

        function updateWeeklyProgress() {
            if (!state.weeklyChart) return;

            // Calculate weekly points
            const weekPoints = [0, 0, 0, 0, 0, 0, 0];
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1);

            currentUser.activity.forEach(activity => {
                const activityDate = new Date(activity.timestamp);
                const dayDiff = Math.floor((activityDate - startOfWeek) / (1000 * 60 * 60 * 24));
                
                if (dayDiff >= 0 && dayDiff < 7) {
                    weekPoints[dayDiff] += activity.points || 0;
                }
            });

            const totalWeekPoints = weekPoints.reduce((a, b) => a + b, 0);
            document.getElementById('weeklyPoints').textContent = `${totalWeekPoints} points`;

            state.weeklyChart.data.datasets[0].data = weekPoints;
            state.weeklyChart.update();
        }

        // Today's focus calculation
        function updateTodayFocus() {
            const today = new Date().toISOString().split('T')[0];
            let totalMinutes = 0;

            currentUser.sessions.forEach(session => {
                if (session.timestamp.startsWith(today)) {
                    totalMinutes += session.duration || 0;
                }
            });

            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            document.getElementById('todayFocus').textContent = `${hours}h ${minutes}m`;
        }

        // Recent sessions
        function renderRecentSessions() {
            const container = document.getElementById('recentSessions');
            const sessions = currentUser.sessions.slice(0, 3);
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-clock text-2xl mb-2 opacity-30"></i>
                        <p class="text-sm">No sessions yet</p>
                    </div>
                `;
                return;
            }

            let html = '';
            sessions.forEach(session => {
                const time = new Date(session.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const platformIcon = getPlatformIcon(session.platform);
                
                html += `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex-1">
                            <div class="font-medium text-sm">${session.topic}</div>
                            <div class="text-xs text-gray-400">${time} â€¢ ${session.duration}min</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">+${session.points}</span>
                            ${platformIcon}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getPlatformIcon(platform) {
            const icons = {
                leetcode: '<i class="fab fa-leetcode text-orange-400"></i>',
                tryhackme: '<i class="fas fa-shield-alt text-red-400"></i>',
                codeforces: '<i class="fas fa-chart-line text-blue-400"></i>',
                github: '<i class="fab fa-github"></i>',
                other: '<i class="fas fa-code text-gray-400"></i>'
            };
            return icons[platform] || icons.other;
        }

        // Session history
        function renderSessionHistory() {
            const container = document.getElementById('sessionHistory');
            const sessions = currentUser.sessions.slice(0, 10);
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="py-8 text-center text-gray-500">
                            <i class="fas fa-history text-2xl mb-2 opacity-30"></i>
                            <p>No sessions recorded yet</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let html = '';
            sessions.forEach(session => {
                const date = new Date(session.timestamp);
                const platformIcon = getPlatformIcon(session.platform);
                
                html += `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="py-3">${date.toLocaleDateString()}</td>
                        <td class="py-3 font-medium">${session.topic}</td>
                        <td class="py-3">
                            <div class="flex items-center gap-2">
                                ${platformIcon}
                                <span>${session.platform || 'Other'}</span>
                            </div>
                        </td>
                        <td class="py-3">${session.duration}min</td>
                        <td class="py-3">
                            <span class="badge badge-success">+${session.points}</span>
                        </td>
                        <td class="py-3">
                            <button onclick="deleteSession(${session.id})" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function deleteSession(sessionId) {
            if (confirm('Are you sure you want to delete this session?')) {
                currentUser.sessions = currentUser.sessions.filter(s => s.id !== sessionId);
                saveUserData();
                updateDashboard();
                toastr.info('Session deleted');
            }
        }

        // Achievements
        function renderAchievements() {
            const container = document.getElementById('achievementsGrid');
            const achievements = [
                { id: 'first_steps', icon: 'ðŸš€', title: 'First Steps', desc: 'Complete first session', unlocked: currentUser.sessions.length > 0 },
                { id: 'streak_3', icon: 'ðŸ”¥', title: '3-Day Streak', desc: '3 consecutive days', unlocked: currentUser.streaks.main.current >= 3 },
                { id: 'streak_7', icon: 'âš¡', title: 'Week Warrior', desc: '7-day streak', unlocked: currentUser.streaks.main.current >= 7 },
                { id: 'points_500', icon: 'ðŸ†', title: '500 Points', desc: 'Earn 500 points', unlocked: currentUser.points >= 500 },
                { id: 'leetcode_50', icon: 'ðŸ’»', title: 'LeetCode 50', desc: 'Solve 50 problems', unlocked: currentUser.platformStats.leetcode?.solved >= 50 },
                { id: 'thm_expert', icon: 'ðŸ›¡ï¸', title: 'THM Expert', desc: 'Complete 20 rooms', unlocked: currentUser.platformStats.tryhackme?.rooms >= 20 },
                { id: 'github_100', icon: 'ðŸ“Š', title: 'GitHub Active', desc: '100+ commits', unlocked: currentUser.platformStats.github?.commits >= 100 },
                { id: 'level_5', icon: 'â­', title: 'Level 5', desc: 'Reach level 5', unlocked: currentUser.level >= 5 }
            ];

            let unlockedCount = 0;
            let html = '';
            
            achievements.forEach(ach => {
                if (ach.unlocked && !currentUser.achievements.includes(ach.id)) {
                    currentUser.achievements.push(ach.id);
                }
                
                const isUnlocked = currentUser.achievements.includes(ach.id);
                if (isUnlocked) unlockedCount++;
                
                html += `
                    <div class="bg-gradient-to-br ${isUnlocked ? 'from-yellow-500/20 to-amber-500/20 border-yellow-500/30' : 'from-gray-800 to-gray-900 border-gray-700'} border rounded-xl p-4 text-center">
                        <div class="text-3xl mb-2">${ach.icon}</div>
                        <div class="font-bold mb-1 ${isUnlocked ? 'text-yellow-400' : 'text-gray-500'}">${ach.title}</div>
                        <div class="text-xs text-gray-400">${ach.desc}</div>
                        ${isUnlocked ? '<div class="mt-2 text-xs text-yellow-400">Unlocked!</div>' : ''}
                    </div>
                `;
            });
            
            document.getElementById('achievementsCount').textContent = `${unlockedCount} unlocked`;
            container.innerHTML = html;
            
            saveUserData();
        }

        // Settings
        function showSettings() {
            toastr.info('Settings page coming soon!');
        }

        // Utility functions
        function triggerConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Initialize app
        window.onload = init;
    </script>
  </body>
</html>
